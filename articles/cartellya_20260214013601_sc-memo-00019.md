---
title: "VPN"
emoji: "✅"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["学習記録"]
published: true
---

# VPN（Virtual Private Network）
インターネット上に暗号化と認証で安全な仮想専用回線を構築する技術です

- 暗号化：通信回線上を流れるパケットを暗号化する
- 完全性検査：通信途中で改ざんがあったかどうかを検知する
- トンネル化：本来のパケットに新しいヘッダを付けて通信するなどしてカプセル化し、end-to-endで透過的な通信を可能にする

### 実現技術
- PPTP
- IPsec
- SSL-VPN
- SSH

# PPTP（Point-to-Point Tunneling Protocol）
Microsoft社が開発した、第２レイヤでVPNを構築するプロトコルです

## 仕組み
1. トンネル確立
    - TCP（ポート1723）で制御チャネルを確立
    - GRE（Generic Routing Encapsulation）でデータ転送

2. 認証
    - PAP、CHAP、MS-CHAPなどPPP認証方式を使用

3. 暗号化
    - MPPE（Microsoft Point-to-Point Encryption）を使用

## 課題
- 認証・暗号強度が弱い

# IPsec（IP security protocol）
https://zenn.dev/cartellya/articles/cartellya_20260214013552_sc-memo-00018

# SSL-VPN
TLS（以前はSSL）を用いて通信を暗号化し、インターネット上に安全なリモートアクセス環境を構築するVPN方式です。

## 仕組み
1. クライアントがVPN装置へHTTPSで接続
2. TLSハンドシェイクでサーバ認証・鍵交換
3. セッション鍵生成
4. 暗号化トンネルを通じて社内リソースへアクセス→ Web通信（TCP 443）を利用するため、FW越えが容易

## 特徴
- トランスポート層(TLS)で動作
- クライアント要件が低い
    - ブラウザ型：専用ソフト不要
    - クライアント型：専用エージェント利用

## 方式
### リバースプロキシ方式
- webブラウザのみ
- SSL-VPN装置はリバースプロキシとしてのみ機能


### ポートフォワーディング方式
- webブラウザ+専用モジュール
- SSL-VPN装置と各種サーバの間に設定が必要です。それに従って振り分けるので、設定したアプリケーションは利用できます
- 専用モジュール例：Javaアプレット、ActiveX

### L2フォワーディング方式
- webブラウザ+専用モジュール
- クライアント側に仮想NICを設定し、サーバ側のネットワークに属する形になります。すべてのアプリケーションを透過的に利用できます

## 課題
- TLSの脆弱性（古いバージョン使用）
- 認証情報の管理不備
- 端末側のマルウェア感染リスク

# SSH（Secure Shell）
ネットワーク経由で遠隔ログインやコマンド実行を安全に行うための暗号化通信プロトコルです

- TCPポート22を使用
- 遠隔端末接続。telnetやrloginなどの安全な代替手段

## 仕組み
- サーバ認証
    - 公開鍵暗号方式を使用
    - サーバの公開鍵をクライアントが検証
- 鍵交換
    - Diffie-Hellman等でセッション鍵を生成
- 通信の暗号化
    - 生成した共通鍵で通信を暗号化
- ユーザ認証
    - パスワード認証
    - 公開鍵認証
    - 多要素認証との併用も可能

## 用途
- サーバのリモート管理
- ファイル転送
    - scp：RCPの安全な代替手段
    - sftp：FTP安全な代替手段
- トンネリング（ポートフォワーディング）