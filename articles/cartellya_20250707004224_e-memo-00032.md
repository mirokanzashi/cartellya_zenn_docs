---
title: "畳み込みニューラルネットワークの特徴"
emoji: "✅"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["学習記録","ニューラルネットワーク"]
published: true
---

## はじめに
:::message alert
記事内容は筆者の勉強まとめ内容です。内容の正確さや漏れについては保証できません。
ご覧いただく際は、ご自身で判断のうえ参考にしてください。
:::


## 概要
- シラバス：E資格2024#2
- 畳み込みニューラルネットワークの基礎知識を勉強する

## キーワード
受容野, 単純型細胞, 複雑型細胞, カーネル, 特徴マップ,
合成性, 移動不変性

## 学習内容

### 畳み込みニューラルネットワーク（CNN: Convolutional Neural Network）
- 最大の特徴は、「畳み込み層（Convolutional Layer）」という特殊な構造を使って、局所的な特徴（エッジ、色、形など）を自動的に抽出できる
- 「局所的な特徴パターン」を抽出するのが得意である
- 応用領域：画像・映像系、自然言語処理、音声、時系列データ、異常検知

### CNNと生物の視覚認知の連想
#### 受容野（Receptive Field）
- ニューロンが入力画像の中で「感知できる領域」のこと
- 画像を例として、CNNのあるニューロンが画像のどの範囲の画素に反応しているかという範囲を指す

#### 単純型細胞（Simple Cell）
- 特定の方向のエッジや線に反応するニューロン
- 単純型細胞の機能は、CNNの畳み込み層のカーネルが模倣している
- カーネルは特定のパターン（エッジやテクスチャ）に反応

:::message
カーネル：CNNではフィルタと同じ意味
:::

#### 複雑型細胞（Complex Cell）
- 単純型細胞よりも広い受容野を持ち、位置のずれに対してもある程度不変（平行移動に強い）。
動きや方向にも敏感
    - 単純型細胞の出力を統合して、位置ずれに対してロバスト
    - エッジの方向は保つが、受容野内の位置が多少変わっても反応
    - 動きや方向選択性もある
- プーリング層（特に最大プーリング）は複雑型細胞のように、位置のずれを吸収し特徴を抽出する
    - これにより平行移動に対して頑健な特徴表現が得られる

#### まとめ
| 用語    | 定義・役割                | CNNでの対応                |
| ----- | -------------------- | ---------------------- |
| 受容野   | ニューロンが感知できる入力の領域     | 畳み込みカーネルのサイズと層の深さにより変化 |
| 単純型細胞 | 位置・方向に敏感なエッジ検出ニューロン  | 畳み込み層のフィルター            |
| 複雑型細胞 | 位置ずれに対して頑健な特徴抽出ニューロン | プーリング層や活性化関数の組み合わせ     |


#### 畳み込み処理
- 画像を例として、カーネルを画像の左上から順番に重ね合わせていき、画像とカーネルの同じ位置の値を掛け合わせて総和をとる処理になる
- カーネルの値は誤差逆伝播法で学習により獲得する
- カーネルサイズはハイパーパラメータとなり、一般的に3×3や5×5などが多く使われる

![](/images/e-memo-00032_01.png)


#### 畳み込みの数式
記法が異なるが、内容は同じ

> 2次元の入力画像𝐼(𝑥,𝑦)に対して、2次元のカーネル𝐾(𝑖,𝑗)を適用した場合

$$
I'(x, y) = \sum_i \sum_j K(i, j) \, I(x + i, y + j)
$$

$$
(I * K)_{i,j} = \sum_{m,n} I_{i+m,j+n} \, K_{m,n}

$$

| 記号                | 意味             |
| ----------------- | -------------- |
| $I(x + i, y + j)$ | 入力画像の画素（位置ずらし） |
| $K(i, j)$         | 畳み込みカーネルの重み    |
| $I'(x, y)$        | 出力特徴マップの画素     |
| $\sum_i \sum_j$   | カーネル全体に対して和をとる |

### 特徴マップ(Feature Map)
- CNNのカーネルが抽出した特徴の空間的な分布を示す出力
- あるカーネルが反応する「パターンの強さと位置」
- 入力の中から「重要なパターン」を抽出する
    - エッジ・色・形など
    - 顔の部品（目、鼻、耳）、オブジェクト構造など

### チャンネル
- 「特徴の層」のこと
    - カラー画像（RGB）：チャンネル数=3（R, G, B）
    - グレースケール画像：チャンネル数=1(明るさ)
    - CT画像：チャンネル数=3(前スライス / 現在のスライス / 次のスライス)
    - PET/CT統合画像：チャンネル数=3(PET画像 / CT画像)

#### チャンネルとカーネル
> 例えば：
> 入力画像：サイズ 32×32×3（チャンネル数3、RGB）
> カーネルサイズ：3×3
> カーネル数：16個（→出力チャンネル数が16）

- 各カーネルは、3つのチャネルに対して それぞれ 3×3 の重みを持つ
- 1つのフィルタは 3×3×3 の重みテンソルである

| 用語    | 説明                       | 例                  |
| ----- | ------------------------ | ------------------ |
| チャンネル | データの層（色や特徴）              | RGB画像 → 3チャンネル     |
| カーネル  | 特徴抽出用のフィルタ               | 3×3×3 の重みテンソル      |
| 関係    | 1つのカーネルは「入力チャンネル分の重み」を持つ | 入力3chなら、カーネルは3×3×3 |



:::message
テンソル：多次元データの集合体のことで、行列の概念を一般化したものである。 具体的には、1次元を「ベクトル」、2次元を「行列」と呼び、それ以上n次元では「n次元配列」と呼ばれる
:::


### 合成性(Compositionality)
- 複雑なパターンは、より単純なパターンの組み合わせとして表現できる
- 音声認識を例として
    - 最初の層では局所的な音量や周波数の変化を検出
    - 次の層で騒音やノイズを検出
    - より深くなる層で人間の声や性別を検出

- 画像認識の例：
    - 最初は小さなエッジを認識する
    - 次のいくつの層でパーツ（目、口）を認識する
    - 最終的に顔全体を認識する

### 移動不変性(Translation Invariance)
- データを多少変えても、同じように認識できる
- 画像の例：
    - 少しの位置ずれ
    - 少しの回転
    - 少しの拡大縮小

:::message
画像自体が大きく回転したり拡大縮小する場合は、畳み込み処理で吸収できる移動不変性を超える場合も出てくるため、データ拡張などで対応する
:::