---
title: "パスワード認証"
emoji: "✅"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["学習記録"]
published: false
---

# パスワード
## 推奨された設定方法
- 十分な安全桁数を用いる（長さ要件）
- 英数字と記号を混在する（文字種要件）
- 推測しやすい文字（連続文字、辞書に存在する単語、キーボード位置など）
- 以前使ったパスワードを使用しない
- 異なるサイトで同じパスワードを使用しない
- パスワード管理ツールを利用して設定する

## 運用方法
- 自動ログオンプロセスにパスワードを含めない
- パスワードは入力時にスクリーンに表示しない（****のように表示する）
  - 可能であれば、画面で見た***の長さと実際パスワードの長さと関係ないように見える
  - ユーザビリティー観点で、マスクを解除できる機能の実装を推奨する
- 他の要素の併用を考慮する
- 秘密に管理する。メモを作らない
- アカウントロックアウト機能の導入（一定回数以上失敗すると、一時的に利用できないようにする）
- レートリミット機能の導入（一定時間内のリクエスト数に制限をかける機能）
- 遅延挿入機能の導入（失敗ごとに応答を遅くらせ、試行速度を落とす機能）
- CAPTCHAの導入
- 一定期間ログインのないユーザーアカウントをサスペンドとする。使用の再開は本人確認手続きとパスワード再設定を経て行う
- パスワードは定期変更を強制せず、漏洩が疑われる場合にだけ変更する

## 管理方法
- 利用者が自らパスワードを管理する
- 正式な管理手続きを定めて管理する
- 発行時や再設定時には確実な本人確認をする
- パスワード運用ルールを利用者に周知し、必要に応じて署名を取る

:::message
当たり前すぎることなので、回答する時に意識できない場合があると思います
:::

- パスワードはソルト付きでハッシュ化し、さらにストレッチングを行って保存する
- 過去のパスワード履歴を安全に保持し、再使用を防止する

:::message
ストレッチング：ハッシュ計算を繰り返したり、計算コストを高めたりすることで、攻撃者による総当たり攻撃を困難する手法です。
:::

- 最初に仮パスワードを発行し、最初のログオン時に変更する場合
  - 発行する仮パスワードは、ランダムな意味のない文字にする
  - 確実な本人確認を実施し、本人に安全な方法で提供。受領通知を受けること
  - 仮パスワード発効後、一定時間放置した場合は自動的に無効にする

## NISTの最新ガイドライン
- SP800-63
- パスワードは文字種の複雑性より、長さを重視する
- 定期的にパスワードを強制変更することは原則禁止的扱いになった

# パスワード認証に対する攻撃
## ブルートフォース攻撃（総当たり攻撃）
- 考えられる文字列を総当たりで試していく手法

### 対策
- オンライン
  - アカウントロックアウト機能
  - レートリミット機能
  - 遅延挿入機能
  - CAPTCHA
  - 二（多）要素認証
- オフライン
  - ソルトを使ってハッシュ化
- 共通
  - 桁数を長くする
  - 文字種を増やす

## 辞書攻撃
- 辞書に含まれる単語、フレーズ、人名、誕生日など意味ある文字を順に試して認証を突破する手法
- ブルートフォース攻撃の一種

### 対策
- ブルートフォースの対策
- オンライン
  - パスワードを意味のない文字列を使う

## パスワードリスト攻撃
- 過去の漏洩で入手した実際の「利用者ID：パスワード」組み合わせリストを用いて、他のサービスでそのままログインを試す手法

### 対策
- ブルートフォースの対策
- 以前使ったパスワードを使用しない
- 異なるサイトで同じパスワードを設定しない
- 漏洩が発覚したときに速やかに変更する

## レインボー攻撃
- パスワードがハッシュ値で保存されているケースで発生する
- 攻撃者はあらかじめ「平文→ハッシュ」の対を保持して、入手したハッシュ値と照合することで平文を特定する
- すべての平文候補を保存するわけではなく、チェーンという技術で容量を節約している

:::message
「平文→ハッシュ」の対をレインボーテーブルと呼びます
:::

### 対策
- ユーザごとに異なるソルトを使う
- ハッシュ値をストレッチング

## リバースブルートフォース
- パスワードを固定して、異なる利用者IDで試行すること
### 対策
- レートリミット機能
- 遅延挿入機能
- 二（多）要素認証

# パスワードの暗号化

| プロトコル     | 安全な認証方式        | 
| ------- | --------------------- | 
| TELNET | SSHに置き換える |
| FTP | SFTP, SSHを使うFTP |
| SMTP | SASL方式、SMTPはもともと認証を持っていなかったため、認証のあるSMTPはSMTP-AUTHという |
| POP3 | SASL方式 |
| IMAP4 | SASL方式 |

### SASL方式
認証をプロトコルから切り離し、共通的に利用できる汎用的な認証メカニズムです

### SASL認証メカニズム比較

| 認証方式 | 意味 |
| --- | --- |
| PLAIN | 平文 |
| SCRAM-SHA-256,<br/>SCRAM-SHA-256-PLUS | ソルトとストレッチングを用いるチャレンジレスポンス方式<br/>ハッシュにはSHA-256を用いる<br/> -PLUSはTLSチャネルバインディングを利用する|
| CRAM-MD5 | OAuth2.0のアクセストークンを用いるトークンベース認証方式 |
| GSSAPI | kerberosを用いる方式 |